<script>
  const coinsEl = document.getElementById("coins");
  const chickensEl = document.getElementById("chickens");
  const cowsEl = document.getElementById("cows");
  const barnShop = document.getElementById("barnShop");
  const animalShop = document.getElementById("animalShop");
  const barnArea = document.getElementById("barnArea");

  let coins = parseInt(localStorage.getItem("coins")) || 20;
  let storage = JSON.parse(localStorage.getItem("storage")) || { eggs: 0, milk: 0, wool: 0, bacon: 0 };
  let upgrades = JSON.parse(localStorage.getItem("upgrades")) || { barn: false, chickens: 0, cows: 0, sheep: 0, pigs: 0 };

  function saveGame() {
    localStorage.setItem("coins", coins);
    localStorage.setItem("storage", JSON.stringify(storage));
    localStorage.setItem("upgrades", JSON.stringify(upgrades));
  }

  function updateUI() {
    coinsEl.textContent = coins;

    // Add counters for all animals
    chickensEl.textContent = upgrades.chickens;
    cowsEl.textContent = upgrades.cows;

    barnArea.innerHTML = "";

    if (upgrades.barn) {
      barnShop.style.display = "none";
      animalShop.style.display = "block";

      // Render chickens
      for (let i = 0; i < upgrades.chickens; i++) {
        const chicken = document.createElement("div");
        chicken.className = "animal";
        chicken.textContent = "ðŸ”";
        chicken.onclick = () => {
          storage.eggs++;
          alert("You collected an ðŸ¥š Egg!");
          saveGame();
        };
        barnArea.appendChild(chicken);
      }

      // Render cows
      for (let i = 0; i < upgrades.cows; i++) {
        const cow = document.createElement("div");
        cow.className = "animal";
        cow.textContent = "ðŸ„";
        cow.onclick = () => {
          storage.milk++;
          alert("You collected ðŸ¥› Milk!");
          saveGame();
        };
        barnArea.appendChild(cow);
      }

      // Render sheep
      for (let i = 0; i < upgrades.sheep; i++) {
        const sheep = document.createElement("div");
        sheep.className = "animal";
        sheep.textContent = "ðŸ‘";
        sheep.onclick = () => {
          storage.wool++;
          alert("You collected ðŸ§¶ Wool!");
          saveGame();
        };
        barnArea.appendChild(sheep);
      }

      // Render pigs
      for (let i = 0; i < upgrades.pigs; i++) {
        const pig = document.createElement("div");
        pig.className = "animal";
        pig.textContent = "ðŸ–";
        pig.onclick = () => {
          storage.bacon++;
          alert("You collected ðŸ¥“ Bacon!");
          saveGame();
        };
        barnArea.appendChild(pig);
      }
    }
  }

  function buyBarn() {
    if (coins >= 50 && !upgrades.barn) {
      coins -= 50;
      upgrades.barn = true;
      updateUI();
      saveGame();
    } else {
      alert("Not enough coins or barn already built!");
    }
  }

  function buyAnimal(type, price) {
    if (coins >= price) {
      coins -= price;
      upgrades[type + "s"]++; // handles chickens, cows, sheep, pigs
      updateUI();
      saveGame();
    } else {
      alert("Not enough coins!");
    }
  }

  function goToFarm() {
    saveGame();
    window.location.href = "farm.html";
  }

  function goToMarket() {
    saveGame();
    window.location.href = "market.html";
  }

  updateUI();
</script>
